<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-01-01 Fri 14:35 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Drag And Drop</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Jack Liu">
<link rel="shortcut icon" href="/images/rose-red.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/dist/style.css" />
<script src="/dist/main.js" defer></script>
</head>
<body>
<div id="content">
<h1 class="title">Drag And Drop</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf31fc91">简介</a></li>
<li><a href="#orgb266c62">示例</a></li>
<li><a href="#org88a2cff">拖放</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf31fc91" class="outline-2">
<h2 id="orgf31fc91">简介</h2>
<div class="outline-text-2" id="text-orgf31fc91">
<p>
<span class="underline">拖放</span> 是一种常见的特性，即抓取对象以后拖到另一个位置。在 HTML5 中，拖放是标准的一部分，任何元素都能够拖放。
</p>

<p>
<code>*注：Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari 支持拖动。</code>
</p>
</div>
</div>

<div id="outline-container-orgb266c62" class="outline-2">
<h2 id="orgb266c62">示例<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></h2>
<div class="outline-text-2" id="text-orgb266c62">
<div class="org-src-container">
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #A6E22E;">div</span> <span style="color: #FD971F;">id</span>=<span style="color: #E6DB74;">"drop-box"</span>
<span class="linenr">2: </span>     <span style="color: #FD971F;">ondrop</span>=<span style="color: #E6DB74;">"drop(event)"</span>
<span class="linenr">3: </span>     <span style="color: #FD971F;">ondragover</span>=<span style="color: #E6DB74;">"allowDrop(event)"</span>&gt;
<span class="linenr">4: </span>&lt;/<span style="color: #A6E22E;">div</span>&gt;
<span class="linenr">5: </span>&lt;<span style="color: #A6E22E;">img</span> <span style="color: #FD971F;">id</span>=<span style="color: #E6DB74;">"drag-ele"</span> <span style="color: #FD971F;">src</span>=<span style="color: #E6DB74;">"./images/drap.png"</span>
<span class="linenr">6: </span>     <span style="color: #FD971F;">draggable</span>=<span style="color: #E6DB74;">"true"</span>
<span class="linenr">7: </span>     <span style="color: #FD971F;">ondragstart</span>=<span style="color: #E6DB74;">"drag(event)"</span>
<span class="linenr">8: </span>     <span style="color: #FD971F;">width</span>=<span style="color: #E6DB74;">"200"</span> <span style="color: #FD971F;">height</span>=<span style="color: #E6DB74;">"160"</span>
<span class="linenr">9: </span>/&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">allowDrop</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">e</span><span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 2: </span>    e.preventDefault<span style="color: #66D9EF;">()</span>
<span class="linenr"> 3: </span><span style="color: #AE81FF;">}</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">drag</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">e</span><span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 6: </span>    e.dataTransfer.setData<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">'Text'</span>, e.target.id<span style="color: #66D9EF;">)</span>
<span class="linenr"> 7: </span><span style="color: #AE81FF;">}</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">drop</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">e</span><span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span>
<span class="linenr">10: </span>    e.preventDefault<span style="color: #66D9EF;">()</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">data</span> = e.dataTransfer.getData<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">'Text'</span><span style="color: #66D9EF;">)</span>;
<span class="linenr">13: </span>    e.target.appendChild<span style="color: #66D9EF;">(</span>document.getElementById<span style="color: #A6E22E;">(</span>data<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>
<span class="linenr">14: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>

<p>
它看上去也许有些复杂，不过我们可以分别研究拖放事件的不同部分。
</p>
</div>
</div>

<div id="outline-container-org88a2cff" class="outline-2">
<h2 id="org88a2cff">拖放</h2>
<div class="outline-text-2" id="text-org88a2cff">
<p>
为了方便后文描述，我们称被拖元素为“小拖”，放置到的目标元素为“小盒” : )
</p>

<p>
<span class="underline">1. 设置元素为可拖放</span>
</p>

<p>
首先，为了使元素可拖动，需要把“小拖”的 <code>draggable</code> 属性设置为 <code>true</code> ，如下：
</p>

<div class="org-src-container">
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #A6E22E;">img</span> <span style="color: #FD971F;">draggable</span>=<span style="color: #E6DB74;">"true"</span> / &gt;
</pre>
</div>

<p>
<span class="underline">2. 设置拖动的触发事件</span>
</p>

<p>
然后，规定当元素被拖动的时候，会发生什么。
</p>

<p>
在上面的例子中， <code>ondragstart</code> 属性调用了一个函数 <code>drag(event)</code> ，它规定了被拖动的数据。
</p>

<p>
如何设置这些数据呢？ <code>dataTransfer.setData()</code> ，我们用它来设置被拖数据的数据类型和值，如下：
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="linenr">1: </span><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">drag</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">e</span><span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span>
<span class="linenr">2: </span>    e.dataTransfer.setData<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">'Text'</span>, e.target.id<span style="color: #66D9EF;">)</span>
<span class="linenr">3: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>

<p>
其中， <code>Text</code> 是一个 DOMString ，表示要添加到“小拖”中的拖动数据的类型，值是“小拖”的 id 。
</p>

<blockquote>
<p>
IE 浏览器中 <code>e.originalEvent.dataTransfer.setData</code> 可能会产生以下报错：
</p>
<ul class="org-ul">
<li>意外地调用了方法或属性访问；</li>
<li>参数无效。</li>
</ul>

<p>
为什么？如何解决呢？原来 <code>setData(key, value)</code> 的 <code>key</code> 在 IE 中只能设置为 <code>Text</code> 或 <code>text</code> 等指定的可选类型（Chrome 中无此限制）， <code>value</code> 最好使用 <code>JSON.stringfy()</code> 序列化一下。
</p>
</blockquote>

<essay>
IE 不死，天下不安。
</essay>

<p>
<span class="underline">3. 设置“小盒”可被放置</span>
</p>

<p>
<code>ondragover</code> 事件规定在何处放置“小拖”的数据。
</p>

<p>
默认情况下，无法将数据/元素放置到其他元素中。如果需要设置允许放置，必须阻止对于元素的默认处理方式，如通过调用 <code>ondragover</code> 事件的 <code>event.preventDefault()</code> 方法。
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="linenr">1: </span>event.preventDefault<span style="color: #AE81FF;">()</span>
</pre>
</div>

<p>
<span class="underline">4. 进行放置</span>
</p>

<p>
当放置“小拖”时，会发生 <code>drop</code> 事件。在上面的例子中， <code>ondrop</code> 属性调用了一个函数 <code>drop(event)</code> ，如下：
</p>

<div class="org-src-container">
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">drop</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">e</span><span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span>
<span class="linenr"> 2: </span>    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#35843;&#29992; `preventDefault()` &#26469;&#36991;&#20813;&#27983;&#35272;&#22120;&#23545;&#25968;&#25454;&#30340;&#40664;&#35748;&#22788;&#29702;</span>
<span class="linenr"> 3: </span>    <span style="color: #75715E;">// </span><span style="color: #75715E;">`drop` &#20107;&#20214;&#30340;&#40664;&#35748;&#34892;&#20026;&#26159;&#20197;&#38142;&#25509;&#24418;&#24335;&#25171;&#24320;</span>
<span class="linenr"> 4: </span>    e.preventDefault<span style="color: #66D9EF;">()</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#36890;&#36807; `dataTransfer.getData('Text')` &#26041;&#27861;&#33719;&#24471;&#8220;&#23567;&#25302;&#8221;&#35774;&#32622;&#30340;&#25968;&#25454;</span>
<span class="linenr"> 7: </span>    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#35813;&#26041;&#27861;&#23558;&#36820;&#22238;&#22312; `setData()` &#26041;&#27861;&#20013;&#35774;&#32622;&#30340;&#30456;&#21516;&#31867;&#22411;&#30340;&#20219;&#20309;&#25968;&#25454;</span>
<span class="linenr"> 8: </span>    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">data</span> = e.dataTransfer.getData<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">'Text'</span><span style="color: #66D9EF;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#36825;&#37324; `data` &#23601;&#26159;&#21069;&#38754;&#35774;&#32622;&#30340; `e.target.id`</span>
<span class="linenr">10: </span>    e.target.appendChild<span style="color: #66D9EF;">(</span>document.getElementById<span style="color: #A6E22E;">(</span>data<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>
<span class="linenr">11: </span><span style="color: #AE81FF;">}</span>
</pre>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.runoob.com/try/try.php?filename=tryhtml5_draganddrop">https://www.runoob.com/try/try.php?filename=tryhtml5_draganddrop</a>
</p></div></div>

</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Date: 2020-11-10 Tue 14:27</p>
<p class="author">Author: Jack Liu</p>
<p class="date">Created: 2021-01-01 Fri 14:35</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
